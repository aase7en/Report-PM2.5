<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap" rel="stylesheet">
  <base target="_top">
<style>
    .widget-container {
  width: 432px;
  height: 60px;
  display: flex;
  overflow: hidden;
  font-family: 'Kanit', sans-serif;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.level-section {
  flex: 1;
  position: relative;
  opacity: 0.25;
  display: flex;
  flex-direction: column;
  transition: all 0.5s ease;
}

.value-box {
  left: 50%;
  position: absolute;
  transform: translateX(-5%);
  top: 1px;
  display: none;
  border-radius: 2px;
  padding: 2px 4px;
  background: rgba(255,255,255,0.8);
  z-index: 1;
}

.active .value-box {
  display: block;
}

.value-content {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.pm-value {
  font-size: 16px;
  font-weight: bold;
  color: black;
}

.pm-unit {
  font-size: 8px;
  color: black;
  margin-top: -2px;
}

.emoji-img {
  width: 40px;
  height: 40px;
  margin-left: 0px;
  position: absolute;
  top: 6px;
  left: 40px;
  animation: bounce 1s infinite;
  filter: drop-shadow(
    0px 0px 1px #fff
  );
}

@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  80% {
    transform: translateY(-4px);
  }
}

.pm-label {
  font-family: 'Kanit', sans-serif;
  font-size: 8px;
  color: white;
  position: absolute;
  top: 28px;
  left: 55px;
  display: none;
}

.active .pm-label {
  display: block;
}

.range-box {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  font-size: 10px;
  color: white;
  text-align: center;
  padding: 5px;
}

.active .range-box {
  display: none;
}

/* Level colors */
.very-good { background: #00BCD4; }
.good { background: #4CAF50; }
.moderate { background: #FFEB3B; }
.unhealthy-sensitive { background: #FF9800; }
.unhealthy { background: #F44336; }

.moderate .range-box,
.moderate .pm-label {
  color: #333 !important;
}
</style>
</head>
<body>
  <div class="widget-container">
    <!-- Level 1: 0-25 -->
    <div class="level-section very-good" id="level1">
      <div class="value-box">
        <div class="value-content">
          <div class="pm-value">--</div>
          <div class="pm-unit">µg/m³</div>
        </div>
      </div>
      <img class="emoji-img" src="https://lh3.googleusercontent.com/d/1TC6j19-qUVDuQhi5PVUx32fVXeutDqQQ" alt="very good emoji">
      <span class="pm-label">ค่าฝุ่น PM2.5</span>
      <div class="range-box">0-25 µg/m³</div>
    </div>
    <!-- Level 2: 26-37 -->
    <div class="level-section good" id="level2">
      <div class="value-box">
        <div class="value-content">
          <div class="pm-value">--</div>
          <div class="pm-unit">µg/m³</div>
        </div>
      </div>
      <img class="emoji-img" src="https://lh3.googleusercontent.com/d/1lZzgY-swxfgGEYRcOwbIuJv7aUQlO-A4" alt="good emoji">
      <span class="pm-label">ค่าฝุ่น PM2.5</span>
      <div class="range-box">26-37 µg/m³</div>
    </div>
    <!-- Level 3: 38-50 -->
    <div class="level-section moderate" id="level3">
      <div class="value-box">
        <div class="value-content">
          <div class="pm-value">--</div>
          <div class="pm-unit">µg/m³</div>
        </div>
      </div>
      <img class="emoji-img" src="https://lh3.googleusercontent.com/d/1yi_ZlTbdUc0d2uEmly31KRfkkRzrNxdY" alt="moderate emoji">
      <span class="pm-label">ค่าฝุ่น PM2.5</span>
      <div class="range-box">38-50 µg/m³</div>
    </div>
    <!-- Level 4: 51-90 -->
    <div class="level-section unhealthy-sensitive" id="level4">
      <div class="value-box">
        <div class="value-content">
          <div class="pm-value">--</div>
          <div class="pm-unit">µg/m³</div>
        </div>
      </div>
      <img class="emoji-img" src="https://lh3.googleusercontent.com/d/1eITs73hJrwzsRl1cLnvtJZTmEAKwMbQS" alt="unhealthy emoji">
      <span class="pm-label">ค่าฝุ่น PM2.5</span>
      <div class="range-box">51-90 µg/m³</div>
    </div>
    <!-- Level 5: 91+ -->
    <div class="level-section unhealthy" id="level5">
      <div class="value-box">
        <div class="value-content">
          <div class="pm-value">--</div>
          <div class="pm-unit">µg/m³</div>
        </div>
      </div>
      <img class="emoji-img" src="https://lh3.googleusercontent.com/d/1cIZnB-nyeRcSQpg6FnwF7FgUC1rhNZ1G" alt="very unhealthy emoji">
      <span class="pm-label">ค่าฝุ่น PM2.5</span>
      <div class="range-box">91+ µg/m³</div>
    </div>
  </div>

  <script> 
    function updateWidget(data) {
      const pm25 = parseFloat(data.pm25);
      
      document.querySelectorAll('.level-section').forEach(section => {
        section.classList.remove('active');
      });
      
      if (pm25 <= 25.0) {
        document.getElementById('level1').classList.add('active');
        document.querySelector('#level1 .pm-value').textContent = pm25.toFixed(1);
      } else if (pm25 <= 37.0) {
        document.getElementById('level2').classList.add('active');
        document.querySelector('#level2 .pm-value').textContent = pm25.toFixed(1);
      } else if (pm25 <= 50.0) {
        document.getElementById('level3').classList.add('active');
        document.querySelector('#level3 .pm-value').textContent = pm25.toFixed(1);
      } else if (pm25 <= 90.0) {
        document.getElementById('level4').classList.add('active');
        document.querySelector('#level4 .pm-value').textContent = pm25.toFixed(1);
      } else {
        document.getElementById('level5').classList.add('active');
        document.querySelector('#level5 .pm-value').textContent = pm25.toFixed(1);
      }
    }

    google.script.run
      .withSuccessHandler(updateWidget)
      .getLatestAirQuality();
    
    setInterval(function() {
      google.script.run
        .withSuccessHandler(updateWidget)
        .getLatestAirQuality();
    }, 3600000);
  </script>
</body>
</html>
